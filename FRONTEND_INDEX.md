# å‰ç«¯ä»£ç ç´¢å¼•

## ğŸ“ æ–‡ä»¶ç»“æ„

```
frontend/
â”œâ”€â”€ index.html              # ä¸»é¡µ
â”œâ”€â”€ detail.html             # å»ºç­‘è¯¦æƒ…é¡µ
â”œâ”€â”€ login.html              # ç™»å½•é¡µ
â”œâ”€â”€ register.html           # æ³¨å†Œé¡µ
â”œâ”€â”€ css/
â”‚   â””â”€â”€ styles.css          # ä¸»æ ·å¼æ–‡ä»¶
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ script.js           # ä¸»è¦JavaScripté€»è¾‘ï¼ˆ1063è¡Œï¼‰
â”‚   â”œâ”€â”€ login-new.js        # ç™»å½•é¡µé€»è¾‘
â”‚   â”œâ”€â”€ register.js         # æ³¨å†Œé¡µé€»è¾‘
â”‚   â””â”€â”€ jquery-3.7.1.min.js # jQueryåº“
â”œâ”€â”€ admin/                  # ç®¡ç†åå°æ¨¡å—ï¼ˆç‹¬ç«‹ï¼‰
â”‚   â”œâ”€â”€ index.html          # ç®¡ç†åå°é¡µé¢
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ admin.css       # ç®¡ç†åå°æ ·å¼
â”‚   â”‚   â””â”€â”€ nav.css         # å¯¼èˆªæ ·å¼
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ admin.js        # ç®¡ç†åå°é€»è¾‘ï¼ˆ936è¡Œï¼‰
â””â”€â”€ text/                   # å»ºç­‘ä»‹ç»æ–‡æœ¬èµ„æº
    â”œâ”€â”€ ForbiddenCity
    â”œâ”€â”€ GreadWall
    â”œâ”€â”€ PotalaPalace
    â”œâ”€â”€ TempleOfHeaven
    â””â”€â”€ YellowCraneTower
```

---

## ğŸ“„ script.js - ä¸»é€»è¾‘æ–‡ä»¶

### ğŸ”§ å…¨å±€å˜é‡

| å˜é‡å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `buildings` | Array | å¤ä»£å»ºç­‘æ•°æ®ï¼ˆä¸­æ–‡ï¼‰ï¼ŒåŒ…å«5ä¸ªå»ºç­‘å¯¹è±¡ |
| `STORAGE_KEY` | String | localStorageé”®å `'ancient_buildings_progress'` |
| `barrageComments` | Array | å¼¹å¹•è¯„è®ºæ•°æ® |
| `barrageInterval` | Number | å¼¹å¹•å®šæ—¶å™¨ID |
| `currentGame` | Object | å½“å‰æ¸¸æˆçŠ¶æ€ |

### ğŸ“¦ æ•°æ®ç®¡ç†å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ | è°ƒç”¨å…³ç³» |
|--------|------|--------|------|----------|
| `getBuildings()` | - | Array | ä»localStorageè·å–å»ºç­‘æ•°æ®ï¼Œåˆå¹¶ä¸­æ–‡ä¿¡æ¯ | è¢«å¤šä¸ªå‡½æ•°è°ƒç”¨ |
| `saveBuildings(data)` | data: Array | - | ä¿å­˜å»ºç­‘æ•°æ®åˆ°localStorage | è¢« `unlockNextLevel()` ç­‰è°ƒç”¨ |

### ğŸ”„ åç«¯åŒæ­¥å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ | APIç«¯ç‚¹ |
|--------|------|--------|------|---------|
| `syncProgressWithBackend()` | - | Promise\<Boolean\> | ä»åç«¯åŒæ­¥è¿›åº¦åˆ°æœ¬åœ° | `GET /api/building/getProgress.php` |
| `updateProgressToBackend(buildingId, isUnlocked)` | buildingId: Number, isUnlocked: Boolean | Promise | æ›´æ–°è¿›åº¦åˆ°åç«¯ | `POST /api/building/updateProgress.php` |

### ğŸª Cookieå·¥å…·å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `getCookie(name)` | name: String | String\|null | è·å–æŒ‡å®šCookieå€¼ |
| `getUserSession()` | - | Object\|null | è§£æuser_session Cookieï¼Œæ”¯æŒåŒé‡ç¼–ç  |
| `updateAuthUI()` | - | - | æ›´æ–°è®¤è¯UIï¼ˆæ˜¾ç¤ºç”¨æˆ·å/é€€å‡ºæŒ‰é’®ï¼‰ |

### ğŸ“‹ é¡µé¢åˆå§‹åŒ–å‡½æ•°

| å‡½æ•°å | è§¦å‘æ¡ä»¶ | è¯´æ˜ |
|--------|----------|------|
| `initHomePage()` | data-page="home" | åˆå§‹åŒ–ä¸»é¡µï¼šæ¸²æŸ“åˆ—è¡¨ã€ç»‘å®šäº‹ä»¶ã€å¯åŠ¨å¼¹å¹• |
| `initDetailPage()` | data-page="detail" | åˆå§‹åŒ–è¯¦æƒ…é¡µï¼šæ˜¾ç¤ºå»ºç­‘ä¿¡æ¯ã€AIèŠå¤©çª—å£ |
| `initLoginPage()` | data-page="login" | åˆå§‹åŒ–ç™»å½•é¡µï¼ˆæ¼”ç¤ºç‰ˆï¼‰ |
| `initRegisterPage()` | data-page="register" | åˆå§‹åŒ–æ³¨å†Œé¡µï¼ˆæ¼”ç¤ºç‰ˆï¼‰ |

### ğŸ¨ UIæ¸²æŸ“å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¯´æ˜ | è°ƒç”¨å…³ç³» |
|--------|------|------|----------|
| `renderList()` | - | æ¸²æŸ“å»ºç­‘å¡ç‰‡æ»šåŠ¨åˆ—è¡¨ | è°ƒç”¨ `getBuildings()`, `setupAutoScroll()` |
| `setupAutoScroll(repeats)` | repeats: Number | è®¾ç½®è‡ªåŠ¨æ»šåŠ¨åŠ¨ç”» | è¢« `renderList()` è°ƒç”¨ |
| `renderLevelMap()` | - | æ¸²æŸ“æ¸¸æˆå…³å¡åœ°å›¾ | è°ƒç”¨ `getBuildings()` |
| `renderQuestion(index)` | index: Number | æ¸²æŸ“æ¸¸æˆé¢˜ç›® | è¢« `enterLevel()`, `handleAnswer()` è°ƒç”¨ |

### ğŸ¤– AIèŠå¤©å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¯´æ˜ | APIç«¯ç‚¹ |
|--------|------|------|---------|
| `sendToAI(text, buildingId)` | text: String, buildingId: Number | å‘é€æ¶ˆæ¯åˆ°AIåç«¯å¹¶æ˜¾ç¤ºå›å¤ | `POST /api/ai/chat.php` |
| `addMessage(text, isUser)` | text: String, isUser: Boolean | åœ¨èŠå¤©çª—å£æ·»åŠ æ¶ˆæ¯ | å†…éƒ¨å‡½æ•° |

### ğŸ¯ å¼¹å¹•ç³»ç»Ÿå‡½æ•°

| å‡½æ•°å | å‚æ•° | è¯´æ˜ | APIç«¯ç‚¹ |
|--------|------|------|---------|
| `initBarrage()` | - | åˆå§‹åŒ–å¼¹å¹•ç³»ç»Ÿï¼Œè·å–è¯„è®ºæ•°æ® | `GET /api/comment/getComments.php` |
| `startBarrage()` | - | å¼€å§‹å¼¹å¹•åŠ¨ç”»å¾ªç¯ | è¢« `initBarrage()` è°ƒç”¨ |
| `spawnBarrageItem()` | - | ç”Ÿæˆå•ä¸ªå¼¹å¹•å…ƒç´  | è¢« `startBarrage()` è°ƒç”¨ |

### ğŸ® æ¸¸æˆæ ¸å¿ƒå‡½æ•°

| å‡½æ•°å | å‚æ•° | è¯´æ˜ | è°ƒç”¨å…³ç³» |
|--------|------|------|----------|
| `startGame()` | - | å¯åŠ¨æ¸¸æˆï¼Œæ˜¾ç¤ºå…³å¡åœ°å›¾ | è°ƒç”¨ `renderLevelMap()` |
| `enterLevel(building)` | building: Object | è¿›å…¥æŒ‡å®šå…³å¡ | è°ƒç”¨ `generateGameQuestions()`, `renderQuestion()` |
| `generateGameQuestions(building)` | building: Object | ç”Ÿæˆæ¸¸æˆé¢˜ç›®ï¼ˆAIç”Ÿæˆæˆ–Mockï¼‰ | è°ƒç”¨ `getMockQuestions()` |
| `getMockQuestions(buildingName)` | buildingName: String | è·å–æ¨¡æ‹Ÿé¢˜ç›®æ•°æ® | è¢« `generateGameQuestions()` è°ƒç”¨ |
| `handleAnswer(selectedIndex, btnElement)` | selectedIndex: Number, btnElement: Element | å¤„ç†ç”¨æˆ·ç­”é¢˜ | è°ƒç”¨ `renderQuestion()` |
| `finishGame()` | - | æ¸¸æˆç»“æŸå¤„ç† | æ˜¾ç¤ºç»“æœç•Œé¢ |
| `submitCommentAndUnlock()` | - | æäº¤è¯„è®ºå¹¶è§£é”ä¸‹ä¸€å…³ | è°ƒç”¨ `unlockNextLevel()`, `renderList()` |
| `unlockNextLevel(currentId)` | currentId: Number | è§£é”ä¸‹ä¸€å…³ | è°ƒç”¨ `saveBuildings()`, `updateProgressToBackend()` |

### ğŸ” éªŒè¯ç å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `createCaptcha(len)` | len: Number (é»˜è®¤4) | String | ç”Ÿæˆéšæœºæ•°å­—éªŒè¯ç  |

---

## ğŸ“„ js/login-new.js - ç™»å½•é¡µé€»è¾‘

### ğŸ“¦ å‡½æ•°åˆ—è¡¨

| å‡½æ•°å | å‚æ•° | è¯´æ˜ | APIç«¯ç‚¹ |
|--------|------|------|---------|
| `createCaptcha(len)` | len: Number | ç”ŸæˆéªŒè¯ç  | - |
| `initLoginPage()` | - | åˆå§‹åŒ–ç™»å½•é¡µé¢ï¼Œç»‘å®šäº‹ä»¶ | `POST /api/user/logincheck.php` |

### ğŸ”„ ä¸»è¦æµç¨‹
1. ç”ŸæˆéªŒè¯ç  â†’ æ˜¾ç¤ºåœ¨é¡µé¢
2. ç”¨æˆ·è¾“å…¥å‡­æ® â†’ éªŒè¯éªŒè¯ç 
3. å‘é€ç™»å½•è¯·æ±‚ â†’ å¤„ç†å“åº”
4. æˆåŠŸï¼šæ¸…é™¤æœ¬åœ°ç¼“å­˜ â†’ è·³è½¬é¡µé¢
5. å¤±è´¥ï¼šæ˜¾ç¤ºé”™è¯¯ â†’ åˆ·æ–°éªŒè¯ç 

---

## ğŸ“„ js/register.js - æ³¨å†Œé¡µé€»è¾‘

### ğŸ“¦ å‡½æ•°åˆ—è¡¨

| å‡½æ•°å | å‚æ•° | è¯´æ˜ | APIç«¯ç‚¹ |
|--------|------|------|---------|
| `createCaptcha(len)` | len: Number | ç”ŸæˆéªŒè¯ç  | - |
| `showMessage(message, type)` | message: String, type: String | æ˜¾ç¤ºæ¶ˆæ¯æç¤º | - |
| è¡¨å•æäº¤äº‹ä»¶ | - | å¤„ç†æ³¨å†Œè¡¨å•æäº¤ | `POST /api/user/register.php` |

### ğŸ“‹ éªŒè¯è§„åˆ™
- **ç”¨æˆ·å**: 4-15ä½å­—æ¯å’Œæ•°å­— `/^[a-zA-Z0-9]{4,15}$/`
- **å¯†ç **: 6-16ä½ï¼Œæ”¯æŒå­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šç¬¦å·

---

## ğŸ“„ admin/js/admin.js - ç®¡ç†åå°é€»è¾‘

### ğŸ”§ å…¨å±€å˜é‡

| å˜é‡å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `currentSearch` | String | å½“å‰ç”¨æˆ·æœç´¢å…³é”®è¯ |
| `currentPage` | Number | å½“å‰ç”¨æˆ·åˆ—è¡¨é¡µç  |
| `currentCommentPage` | Number | å½“å‰è¯„è®ºåˆ—è¡¨é¡µç  |
| `currentCommentSearch` | String | å½“å‰è¯„è®ºæœç´¢å…³é”®è¯ |

### ğŸ” è®¤è¯å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `getCookie(name)` | name: String | String\|null | è¯»å–Cookie |
| `checkAdminAuthWithRetry()` | - | - | å¸¦é‡è¯•çš„ç®¡ç†å‘˜æƒé™æ£€æŸ¥ï¼ˆ10ç§’è¶…æ—¶ï¼‰ |
| `checkAdminAuth()` | - | Object\|null | å•æ¬¡æƒé™æ£€æŸ¥ |

### ğŸ‘¥ ç”¨æˆ·ç®¡ç†å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¯´æ˜ | APIç«¯ç‚¹ |
|--------|------|------|---------|
| `loadUserList(page, search)` | page: Number, search: String | åŠ è½½ç”¨æˆ·åˆ—è¡¨ | `GET /api/admin/getUsers.php` |
| `displayUserList(users, paginationInfo)` | users: Array, paginationInfo: Object | æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨è¡¨æ ¼ | - |
| `editUser(username)` | username: String | ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ | `POST /api/admin/updateUser.php` |
| `deleteUser(username)` | username: String | åˆ é™¤ç”¨æˆ· | `POST /api/admin/deleteUser.php` |
| `editUserProgress(username)` | username: String | ä¿®æ”¹ç”¨æˆ·è¿›åº¦ | `POST /api/admin/updateUserProgress.php` |
| `getProgressText(progress)` | progress: Object | æ ¼å¼åŒ–è¿›åº¦æ˜¾ç¤ºæ–‡æœ¬ | - |

### ğŸ’¬ è¯„è®ºç®¡ç†å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¯´æ˜ | APIç«¯ç‚¹ |
|--------|------|------|---------|
| `loadCommentList(page, search)` | page: Number, search: String | åŠ è½½è¯„è®ºåˆ—è¡¨ | `GET /api/comment/getComments.php` |
| `displayCommentList(comments, paginationInfo)` | comments: Array, paginationInfo: Object | æ¸²æŸ“è¯„è®ºåˆ—è¡¨è¡¨æ ¼ | - |
| `deleteComment(commentId)` | commentId: Number | åˆ é™¤è¯„è®º | `POST /api/comment/deleteComment.php` |
| `editComment(commentId, currentContent)` | commentId: Number, currentContent: String | ä¿®æ”¹è¯„è®º | `POST /api/comment/updateComment.php` |

### ğŸ›ï¸ äº‹ä»¶ç»‘å®šå‡½æ•°

| å‡½æ•°å | è¯´æ˜ |
|--------|------|
| `bindEvents()` | ç»‘å®šç”¨æˆ·ç®¡ç†ç›¸å…³äº‹ä»¶ï¼ˆæ·»åŠ ã€æœç´¢ã€åˆ†é¡µã€é€€å‡ºï¼‰ |
| `bindNavEvents()` | ç»‘å®šå¯¼èˆªåˆ‡æ¢äº‹ä»¶ã€è¯„è®ºç®¡ç†äº‹ä»¶ |

### ğŸ›¡ï¸ å·¥å…·å‡½æ•°

| å‡½æ•°å | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `escapeHtml(text)` | text: String | String | HTMLè½¬ä¹‰é˜²XSSæ”»å‡» |

---

## ğŸ”— å‡½æ•°è°ƒç”¨å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DOMContentLoaded                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ initHomePage()â”‚      â”‚initDetailPage()â”‚      â”‚ adminåˆå§‹åŒ–   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                      â”‚
        â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ updateAuthUI()â”‚      â”‚syncProgress() â”‚      â”‚checkAdminAuth â”‚
â”‚ initBarrage() â”‚      â”‚     â–¼         â”‚      â”‚WithRetry()    â”‚
â”‚ renderList()  â”‚      â”‚ å¡«å……å»ºç­‘ä¿¡æ¯  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ AIèŠå¤©ç»‘å®š    â”‚              â”‚
        â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â–¼
        â–¼                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚loadUserList() â”‚
â”‚setupAutoScrollâ”‚                             â”‚ bindEvents()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚bindNavEvents()â”‚
        â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  startGame()  â”‚â—„â”€â”€â”€â”€â”€â”‚  play-btn     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚renderLevelMap()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ enterLevel()  â”‚â”€â”€â”€â”€â”€â–ºâ”‚generateGameQuestionsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                         â”‚
        â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚renderQuestion()â”‚â—„â”€â”€â”€â”€â”‚ getMockQuestions()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚handleAnswer() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ finishGame()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚submitCommentAnd    â”‚
â”‚Unlock()            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚unlockNextLevelâ”‚â”€â”€â”€â”€â”€â–ºâ”‚updateProgressTo     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚Backend()            â”‚
        â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚saveBuildings()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ APIè°ƒç”¨æ±‡æ€»

### ç”¨æˆ·ç›¸å…³
| APIç«¯ç‚¹ | æ–¹æ³• | è°ƒç”¨ä½ç½® | ç”¨é€” |
|---------|------|----------|------|
| `/api/user/logincheck.php` | POST | login-new.js | ç”¨æˆ·ç™»å½• |
| `/api/user/register.php` | POST | register.js | ç”¨æˆ·æ³¨å†Œ |

### å»ºç­‘è¿›åº¦ç›¸å…³
| APIç«¯ç‚¹ | æ–¹æ³• | è°ƒç”¨ä½ç½® | ç”¨é€” |
|---------|------|----------|------|
| `/api/building/getProgress.php` | GET | script.js | è·å–ç”¨æˆ·è¿›åº¦ |
| `/api/building/updateProgress.php` | POST | script.js | æ›´æ–°ç”¨æˆ·è¿›åº¦ |
| `/api/building/resetProgress.php` | POST | script.js | é‡ç½®ç”¨æˆ·è¿›åº¦ |

### AIç›¸å…³
| APIç«¯ç‚¹ | æ–¹æ³• | è°ƒç”¨ä½ç½® | ç”¨é€” |
|---------|------|----------|------|
| `/api/ai/chat.php` | POST | script.js | AIèŠå¤© |
| `/api/ai/generateQuestions.php` | POST | script.js | ç”Ÿæˆæ¸¸æˆé¢˜ç›® |

### è¯„è®ºç›¸å…³
| APIç«¯ç‚¹ | æ–¹æ³• | è°ƒç”¨ä½ç½® | ç”¨é€” |
|---------|------|----------|------|
| `/api/comment/getComments.php` | GET | script.js, admin.js | è·å–è¯„è®ºåˆ—è¡¨ |
| `/api/comment/addComment.php` | POST | script.js, admin.js | æ·»åŠ è¯„è®º |
| `/api/comment/deleteComment.php` | POST | admin.js | åˆ é™¤è¯„è®º |
| `/api/comment/updateComment.php` | POST | admin.js | ä¿®æ”¹è¯„è®º |

### ç®¡ç†å‘˜ç›¸å…³
| APIç«¯ç‚¹ | æ–¹æ³• | è°ƒç”¨ä½ç½® | ç”¨é€” |
|---------|------|----------|------|
| `/api/admin/getUsers.php` | GET | admin.js | è·å–ç”¨æˆ·åˆ—è¡¨ |
| `/api/admin/addUser.php` | POST | admin.js | æ·»åŠ ç”¨æˆ· |
| `/api/admin/updateUser.php` | POST | admin.js | ä¿®æ”¹ç”¨æˆ· |
| `/api/admin/deleteUser.php` | POST | admin.js | åˆ é™¤ç”¨æˆ· |
| `/api/admin/updateUserProgress.php` | POST | admin.js | ä¿®æ”¹ç”¨æˆ·è¿›åº¦ |

---

## ğŸ—ï¸ å»ºç­‘IDæ˜ å°„

| ID | ä¸­æ–‡å | è‹±æ–‡Key | é¡µé¢ä½ç½® |
|----|--------|---------|----------|
| 1 | ç´«ç¦åŸ | ForbiddenCity | down |
| 2 | å¤©å› | TempleOfHeaven | center |
| 3 | å¸ƒè¾¾æ‹‰å®« | PotalaPalace | up |
| 4 | é»„é¹¤æ¥¼ | YellowCraneTower | left |
| 5 | é•¿åŸ | GreatWall | right |

---

## ğŸ“ æ•°æ®å­˜å‚¨

### localStorage
- **Key**: `ancient_buildings_progress`
- **Value**: JSONæ•°ç»„ï¼ŒåŒ…å«å»ºç­‘å¯¹è±¡åŠå…¶è§£é”çŠ¶æ€

### Cookie
- **Key**: `user_session`
- **Value**: URLç¼–ç çš„JSONå¯¹è±¡ï¼ŒåŒ…å« `username` å’Œ `is_admin` å­—æ®µ
